{{ if .Params.slides }}
<div class="slideshow-container">
  <div class="slideshow">
    {{ range $index, $slide := .Params.slides }}
    {{ $image := $.Page.Resources.GetMatch $slide.image }}
    
    <!-- Generate various sized images for different devices -->
    {{ $imageXs := $image.Resize "300x" }}
    {{ $imageSm := $image.Resize "500x" }}
    {{ $imageMd := $image.Resize "700x" }}
    {{ $imageLg := $image.Resize "1080x" }}
    {{ $imageXl := $image.Resize "1280x" }}
    
    <!-- WebP versions -->
    {{ $imageXsWebP := $imageXs.Process "webp" }}
    {{ $imageSmWebP := $imageSm.Process "webp" }}
    {{ $imageMdWebP := $imageMd.Process "webp" }}
    {{ $imageLgWebP := $imageLg.Process "webp" }}
    {{ $imageXlWebP := $imageXl.Process "webp" }}
    
    <div class="slide {{ if eq $index 0 }}active{{ else }}inactive{{ end }}" data-index="{{ $index }}">
      <div class="slide-content">
        <picture>
          <!-- WebP versions with more size options -->
          <source 
            srcset="{{ $imageXsWebP.RelPermalink }} 300w, 
                    {{ $imageSmWebP.RelPermalink }} 500w, 
                    {{ $imageMdWebP.RelPermalink }} 700w, 
                    {{ $imageLgWebP.RelPermalink }} 1080w, 
                    {{ $imageXlWebP.RelPermalink }} 1280w"
            sizes="(min-width: 1280px) 1280px, 100vw"
            type="image/webp">
          <!-- Fallback for browsers that don't support WebP -->
          <img src="{{ $image.RelPermalink }}" 
               srcset="{{ $imageXs.RelPermalink }} 300w,
                       {{ $imageSm.RelPermalink }} 500w,
                       {{ $imageMd.RelPermalink }} 700w,
                       {{ $imageLg.RelPermalink }} 1080w,
                       {{ $imageXl.RelPermalink }} 1280w"
               sizes="(min-width: 1280px) 1280px, 100vw"
               width="{{ $image.Width }}" 
               height="{{ $image.Height }}"
               alt="{{ with $slide.caption }}{{ . }}{{ else }}Artwork by Jill Bonovitz{{ end }}" 
               class="slide-image"
               {{ if ne $index 0 }}loading="lazy"{{ end }}>
        </picture>
      </div>
    </div>
    {{ end }}
    
    <div class="slide-footer">
      <div class="slide-count">
        <span id="current-slide">1</span> / <span id="total-slides">{{ len .Params.slides }}</span>
      </div>
      
      {{ range $index, $slide := .Params.slides }}
      <div class="caption {{ if eq $index 0 }}active{{ else }}inactive{{ end }}">
        {{ $slide.caption }}
      </div>
      {{ end }}
    </div>
    
    <button class="slide-nav prev" aria-label="Previous slide">&lt;</button>
    <button class="slide-nav next" aria-label="Next slide">&gt;</button>
  </div>
</div>
{{ end }}