{{ if .Params.slides }}
<div class="slideshow-container">
  <div class="slideshow">
    {{ range $index, $slide := .Params.slides }}
    {{ $image := $.Page.Resources.GetMatch $slide.image }}
    
    <!-- Generate only 3 sizes aligned with our breakpoints -->
    {{ $smallImage := $image.Resize "480x" }}    <!-- For $breakpoint-small devices -->
    {{ $mediumImage := $image.Resize "900x" }}   <!-- For $breakpoint-mobile/tablet -->
    {{ $largeImage := $image.Resize "1600x" }}   <!-- For desktop/large screens -->
    
    <!-- WebP versions -->
    {{ $smallImageWebP := $smallImage.Process "webp q95" }}
    {{ $mediumImageWebP := $mediumImage.Process "webp q95" }}
    {{ $largeImageWebP := $largeImage.Process "webp q95" }}
    
    <!-- Slide content here -->
    <div class="slide {{ if eq $index 0 }}active{{ else }}inactive{{ end }}" data-index="{{ $index }}">
      <div class="slide-content">
        <!-- Picture element here -->
        <picture>
          <!-- WebP versions -->
          <source 
            srcset="{{ $smallImageWebP.RelPermalink }} 480w, 
                    {{ $mediumImageWebP.RelPermalink }} 900w, 
                    {{ $largeImageWebP.RelPermalink }} 1600w"
            sizes="(max-width: 480px) 480px, 
                   (max-width: 900px) 900px, 
                   1600px"
            type="image/webp">
            
          <!-- Fallback for browsers that don't support WebP -->
          <img src="{{ $mediumImage.RelPermalink }}" 
               srcset="{{ $smallImage.RelPermalink }} 480w,
                       {{ $mediumImage.RelPermalink }} 900w,
                       {{ $largeImage.RelPermalink }} 1600w"
               sizes="(max-width: 480px) 100vw, 
                      (max-width: 900px) 100vw, 
                      100vw"
               width="{{ $image.Width }}" 
               height="{{ $image.Height }}"
               alt="{{ with $slide.caption }}{{ . }}{{ else }}Artwork by Jill Bonovitz{{ end }}" 
               class="slide-image"
               {{ if ne $index 0 }}loading="lazy"{{ end }}>
        </picture>
      </div>
    </div>
    {{ end }}
    
    <!-- Desktop navigation buttons - positioned over images -->
    <button class="slide-nav desktop-nav prev" aria-label="Previous slide">&lt;</button>
    <button class="slide-nav desktop-nav next" aria-label="Next slide">&gt;</button>
    
    <div class="slide-footer">
      <div class="slide-nav-container">
        <button class="slide-nav mobile-nav prev" aria-label="Previous slide">&lt;</button>
        <div class="slide-count">
          <span id="current-slide">1</span> / <span id="total-slides">{{ len .Params.slides }}</span>
        </div>
        <button class="slide-nav mobile-nav next" aria-label="Next slide">&gt;</button>
      </div>
      
      <!-- Captions -->
      {{ range $index, $slide := .Params.slides }}
      <div class="caption {{ if eq $index 0 }}active{{ else }}inactive{{ end }}">
        {{ $slide.caption }}
      </div>
      {{ end }}
    </div>
  </div>
</div>
{{ end }}